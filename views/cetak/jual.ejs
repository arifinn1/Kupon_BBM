<% layout('layout-blank') -%>

<body class="f-11">
  <div class="container-fluid">
    <div class="row address-header">
      <div class="col-xs-4 text-center" style="font-size: 28px;
      margin-bottom: -5px;">
        <span><%= spbu.nama %></span>
      </div>

      <div class="col-xs-8">
        <span class="f-14"><b>SPBU <%= spbu.kd_pertamina+` `+spbu.alias %></b></span><br>
        <span><%= spbu.alamat+`, Telp. `+spbu.telp %></span>
      </div>
    </div>

    <div class="row f-12">
      <div class="col-xs-2 f-18">KUITANSI</div>

      <div class="col-xs-4 text-right">
        <div class="row">
          <div class="col-xs-12">No :</div>
          <div class="col-xs-12">Sudah diterima dari :</div>
        </div>
      </div>

      <div class="col-xs-6">
        <div class="row">
          <div class="col-xs-12"><%= jual.kd %></div>
          <div class="col-xs-12"><div class="alert alert-bw-skinny" role="alert"><%= jual.kd_instansi+` - `+jual.nm_instansi %></div></div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-xs-12">
        <table id="tdetail" class="table table-striped outer-border mini-pad">
          <thead>
            <tr>
              <th class="text-center f-12" colspan="6">U R A I A N</th>
              <th class="text-center f-12 left-border" colspan="2">U A N G</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-12 f-12">Cilacap, &nbsp; <%= jual.s_tanggal %></div>
      
      <div class="col-xs-12 f-12 signature text-right">H. BUDI SADEWO, S.H., M.Kn.</div>
    </div>

  </div>
</body>

<script>
  let jual = JSON.parse((`<%= JSON.stringify(jual) %>`).replace(/&quot;/g, '"'));
  let det_jual = JSON.parse((`<%= JSON.stringify(det_jual) %>`).replace(/&quot;/g, '"'));
  
  $(document).ready(function() {
    let t_html = '', liter = 0, rupiah = 0;
    t_html += `<tr><td class="text-center" colspan="6">Pembelian kupon di SPBU `+jual.kd_pertamina+` `+jual.alias+` berupa :</td><td class="left-border" colspan="2"></td></tr>`;

    for (let i=0; i<det_jual.length; i++) {
      liter += det_jual[i].liter;
      rupiah += det_jual[i].rupiah;
      let n_kupon = det_jual[i].kupon_awal + det_jual[i].lembar - 1;
      n_kupon = n_kupon>10000 ? n_kupon - 10000 : n_kupon;

      t_html += `<tr>
          <td class="text-right fit">`+det_jual[i].liter+`</td>
          <td>Ltr `+det_jual[i].nm_bbm+`</td>
          <td>@ `+det_jual[i].jenis+`</td>
          <td class="fit">Rp</td>
          <td class="text-right fit">`+det_jual[i].harga.toLocaleString(['ban', 'id'])+`</td>
          <td class="text-center">( `+det_jual[i].kupon_awal+` - `+n_kupon+` )</td>
        
          <td class="fit left-border">Rp</td>
          <td class="text-right fit">`+det_jual[i].rupiah.toLocaleString('id-ID')+`</td>
        </tr>`;
    }
    t_html += `<tr class="f-12">
        <th class="text-right">`+liter+`</th>
        <th class="text-right" colspan="5">JUMLAH PEMBAYARAN</th>
        <th class="left-border">Rp</th><th class="text-right">`+rupiah.toLocaleString('id-ID')+`</th>
      </tr><tr>
        <th class="text-center f-12" colspan="8">`+js_fun.terbilang(rupiah).toUpperCase()+`</th>
      </tr>`;
    
    $('#tdetail tbody').html(t_html);

    window.print();
  });
</script>